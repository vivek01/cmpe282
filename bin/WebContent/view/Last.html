
<!DOCTYPE html>
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
<meta charset="utf-8" />

<!-- Set the viewport width to device width for mobile -->
<meta name="viewport" content="width=device-width" />

<title style=color:#3B5998>Cloud EStore</title>

<link rel="stylesheet" href="../assets/css/normalize.css">
<link rel="stylesheet" href="../assets/css/foundation.css">
<script type="text/javascript" src="http://code.jquery.com/jquery.js"></script>
<script src="../assets/js/vendor/custom.modernizr.js"></script>
<script>
	function validateForm() {
		var x = document.forms["nortonBuy"]["n360"].value;
		if (x > 0) {

			return true;
		} else {
			return false;
		}
	}
</script>
<script language="JavaScript">
	var l;
	function processUser() {
		var parameters = location.search.substring(1).split("&");

		var temp = parameters[0].split("=");
		l = unescape(temp[1]);
		alert(l);
		user(l);
		last();
	}

	function user(l) {

		var URL = "http://ec2-54-172-52-250.compute-1.amazonaws.com:8080/CloudServices/rest/users/session";
		alert("signin button clicked" + formToJSON(l));

		$.ajax({
			type : "POST",
			url : URL,
			contentType : "application/json",
			dataType : 'json',
			data : formToJSON(l),
			//success: function () { //success(data); }
			success : function(data, textStatus, jqXHR) {

				var msg = data.msg;
				document.getElementById("final").style.fontSize = "xx-large";
				document.getElementById("final").style.fontWeight = 'bold';
				document.getElementById("final").innerHTML = "Welcome " + msg;
				alert(msg);
			},
			error : function(textStatus, jqXHR, errorThrown) {
				alert(textStatus + " " + jqXHR);
			}

		});
	}
	function formToJSON(l) {
		return JSON.stringify({
			"authId" : l
		});
	}

	function catalog() {
		var U = "http://ec2-54-172-52-250.compute-1.amazonaws.com:8080/CloudServices/rest/catalog/";
		$.getJSON(catalogU, function(json) {
			var length = json.product.length;
			alert(length);
			var ele = new Array();
			var docFrag = document.createDocumentFragment();
			for (index = 0; index < length; index++) {
				alert(index + json.product[index].name + json.product[index].id
						+ json.product[index].price)
				ele[index] = createDiv(index, json.product[index].name,
						json.product[index].id, json.product[index].price);
			}

			for (k = 0; k < ele.length; k++) {
				docFrag.appendChild(ele[k]);
			}
			document.getElementById("contain").appendChild(docFrag);

		});
	}

	function last() {
		alert("inside history")

		var addURL = "http://ec2-54-172-52-250.compute-1.amazonaws.com:8080/CloudServices/rest/users/login";

		$.ajax({
			type : "POST",
			url : addURL,
			contentType : "application/json",
			dataType : 'json',
			data : idToJSON(),
			//success: function () { //success(data); }
			success : function(data, textStatus, jqXHR) {
				alert("message suceede")
				if (data.message == "success") {

					var length = data.time;
					alert(length);

					var docFrag = document.createDocumentFragment();

					var ele = createDiv( data.time);

					//docFrag.appendChild(ele);

					document.getElementById("contain").appendChild(ele);
					alert("success")
				}

			},
			error : function(textStatus, jqXHR, errorThrown) {
				alert(textStatus + " " + jqXHR);
			}

		});

	}

	function idToJSON() {
		return JSON.stringify({
			"authId" : l,

		});
	}
	function createDiv(time) {//document.getElementById("contain").appendChild(newDiv);

		var newDiv = document.createElement('div');
		newDiv.setAttribute("class", "row");
		newDiv.setAttribute("id", "main");
		newDiv.innerHTML = time;
		alert("Div created")
		return newDiv;

	}

	function cartRedirect() {
		window.location
				.replace("http://ec2-54-172-52-250.compute-1.amazonaws.com:8080/CloudServices/view/cart.html?authid="
						+ l);
	}

	function purchaseRedirect() {
		window.location
				.replace("http://ec2-54-172-52-250.compute-1.amazonaws.com:8080/CloudServices/view/Purchase.html?authid="
						+ l);
	}
	function historyRedirect() {
		window.location
				.replace("http://ec2-54-172-52-250.compute-1.amazonaws.com:8080/CloudServices/view/History.html?authid="
						+ l);
	}
</script>
<!-- onload="processUser()" -->
</head>
<body onload="processUser()" class="off-canvas hide-extras">
	<div class="row">
		<div class="large-12 columns">

			<!-- Navigation -->
			<div class="fixed">
				<nav class="top-bar">
					<ul class="title-area">
						<!-- Title Area -->
						<li class="name">
							<h1>
								<a href="home.html"> <img src="../img/macpro.jpg"
									style="max-height: 80px; max-width: 80px">
								</a>
							</h1>
						</li>
						<li class="toggle-topbar menu-icon"><a href=#><span>Menu</span></a></li>
					</ul>

					<section class="top-bar-section">

						<ul class="left">
							<li class="divider"></li>
							<li id="bu1" class="has-button"><input type="submit"
								class="medium button centered" value="View Cart"
								onclick="cartRedirect()"></li>
							<li class="divider"></li>
							<li id="bu2" class="has-button"><input type="submit"
								class="medium button centered" value="Purchase"
								onclick="purchaseRedirect()"></li>
							<li class="divider"></li>
							<li id="bu3" class="has-button"><input type="submit"
								class="medium button centered" value="History"
								onclick="historyRedirect()"></li>
							
						</ul>

						<ul class="right">



							<li class="divider"></li>
							<li id="bu" class="has-button"><a id="bu"
								class="button round" href="logout.html">Sign Out</a></li>
						</ul>
					</section>
				</nav>
			</div>
			<!-- End Navigation -->

		</div>
	</div>
	<!-- End of first row -->
	<!--start of second row-->
	<div class="row">
		<div class="large-2 columns">
			<br> <br>
			<div id="final"></div>
		</div>

		<div class="large-10 columns">
			<div class="row">
				<h3 align="center" style="color: #0099FF">
					<b><i>EStore Products</i></b>
				</h3>
			</div>
			<div id="contain"></div>

		</div>




		<!-- Footer -->

		<footer class="row">
			<div class="large-12 columns">
				<hr>
				<div class="row">
					<div class="large-6 columns">
						<p>&copy; Copyright Estore 282</p>
					</div>
					<div class="large-6 columns"></div>
				</div>
			</div>
		</footer>

		<script>
			document.write('<script src=../js/vendor/'
					+ ('__proto__' in {} ? 'zepto' : 'jquery')
					+ '.js><\/script>')
		</script>
		<script src="../assets/js/foundation.min.js"></script>
		<script>
			$(document).foundation();
		</script>
		<script type="text/javascript">
			$(window).load(function() {
				$('#featured').orbit({
					fluid : '2x1'
				});
			});
		</script>
		<!-- End Footer -->
</body>
</html>